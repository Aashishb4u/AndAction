generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String     @id @default(cuid())
  email                   String?    @unique
  emailVerified           DateTime?  @map("email_verified")
  name                    String?
  image                   String?
  firstName               String?
  lastName                String?
  countryCode             String?
  phoneNumber             String?    @unique
  password                String?
  city                    String?
  state                   String?
  address                 String?
  zip                     String?
  role                    String     @default("user")
  isAccountVerified       Boolean    @default(false)
  isArtistVerified        Boolean    @default(false)
  gender                  String?
  dob                     DateTime?
  googleId                String?    @unique
  facebookId              String?    @unique
  appleId                 String?    @unique
  createdAt               DateTime   @default(now())
  updatedAt               DateTime   @updatedAt
  resetToken              String?
  resetTokenExpiry        DateTime?
  verificationToken       String?
  verificationTokenExpiry DateTime?
  avatar                  String?
  isDataSharingOptIn      Boolean    @default(false)
  isMarketingOptIn        Boolean    @default(false)
  artist                  Artist?
  bookings                Booking[]
  bookmarks               Bookmark[]
  videos                  Video[]
  accounts                Account[]
  sessions                Session[]

  @@index([email])
  @@index([phoneNumber])
  @@map("users")
}

model VerificationToken {
  id         String   @id @default(cuid())
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())

  @@unique([identifier, token])
  @@index([identifier])
  @@map("verification_tokens")
}
model Account {
  id                String  @id @default(cuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}



model Artist {
  id                             String     @id @default(cuid())
  userId                         String     @unique
  stageName                      String?
  artistType                     String?
  subArtistType                  String?
  achievements                   String?
  yearsOfExperience              Int?
  shortBio                       String?
  performingLanguage             String?
  performingEventType            String?
  performingStates               String?
  performingDurationFrom         String?
  performingDurationTo           String?
  performingMembers              String?
  offStageMembers                String?
  contactNumber                  String?
  whatsappNumber                 String?
  contactEmail                   String?
  soloChargesFrom                Decimal?   @db.Decimal(10, 2)
  soloChargesTo                  Decimal?   @db.Decimal(10, 2)
  soloChargesDescription         String?
  chargesWithBacklineFrom        Decimal?   @db.Decimal(10, 2)
  chargesWithBacklineTo          Decimal?   @db.Decimal(10, 2)
  chargesWithBacklineDescription String?
  youtubeChannelId               String?
  instagramId                    String?
  
  // YouTube Integration
  youtubeAccessToken             String?    @db.Text
  youtubeRefreshToken            String?    @db.Text
  youtubeTokenExpiry             DateTime?
  youtubeChannelName             String?
  youtubeConnectedAt             DateTime?
  
  // Instagram Integration (for future)
  instagramAccessToken           String?    @db.Text
  instagramTokenExpiry           DateTime?
  instagramUsername              String?
  instagramConnectedAt           DateTime?
  
  createdAt                      DateTime   @default(now())
  updatedAt                      DateTime   @updatedAt
  user                           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  bookingsReceived               Booking[]
  bookmarkedByUsers              Bookmark[]

  @@index([userId])
  @@index([artistType])
  @@map("artists")
}

model Video {
  id                String     @id @default(cuid())
  
  youtubeVideoId    String?    @unique 
  
  userId            String
  title             String
  description       String?
  url               String
  thumbnailUrl      String?
  duration          Int        @default(0)
  durationFormatted String?   
  views             Int        @default(0)
  publishedAt       DateTime?
  isShort           Boolean    @default(false) 
  source            String     @default("youtube")
  isApproved        Boolean    @default(false)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  bookmarkedByUsers Bookmark[]
  user              User       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([isApproved])
  @@index([youtubeVideoId])
  @@index([isShort])
  @@map("videos")
}

model Bookmark {
  id        String   @id @default(cuid())
  userId    String
  videoId   String?
  artistId  String?
  createdAt DateTime @default(now())
  artist    Artist?  @relation(fields: [artistId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])
  video     Video?   @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
  @@unique([userId, artistId])
  @@index([userId])
  @@map("bookmarks")
}

model Booking {
  id            String        @id @default(cuid())
  clientId      String
  artistId      String
  state         String?
  city          String?
  eventDate     DateTime
  eventType     String?
  eventLocation String?
  eventAddress  String?
  totalPrice    Decimal       @db.Decimal(10, 2)
  status        BookingStatus @default(PENDING)
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  artist        Artist        @relation(fields: [artistId], references: [id])
  client        User          @relation(fields: [clientId], references: [id])

  @@index([clientId])
  @@index([artistId])
  @@index([status])
  @@unique([artistId, eventDate])

  @@map("bookings")
}

enum BookingStatus {
  PENDING
  APPROVED
  DECLINED
  CANCELLED
  COMPLETED
}
