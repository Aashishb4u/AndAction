// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum for Booking Status
enum BookingStatus {
  PENDING       // Client requested, waiting for artist review
  APPROVED      // Artist accepted, waiting for client payment
  DECLINED      // Artist declined the booking
  CANCELLED     // Booking cancelled by client or artist
  COMPLETED     // Event happened, payment finalized
}

// User Model - Main user table for authentication and profile
model User {
  id                      String    @id @default(cuid())
  email                   String?   @unique

  // Basic Profile Information (all nullable except email - now also nullable)
  firstName               String?
  lastName                String?
  countryCode             String?
  phoneNumber             String?   @unique
  password                String?   // Nullable for OAuth users

  // Password Reset Fields
  resetToken              String?
  resetTokenExpiry        DateTime?

  // ðŸ›‘ COMMENTED OUT: We will use the new 'VerificationToken' model for sign-up OTPs.
  // phoneOtp                String?
  // phoneOtpExpiry          DateTime?

  // SECURITY FLOWS
  verificationToken       String?
  verificationTokenExpiry DateTime?

  // Location Information
  city                    String?
  state                   String?
  address                 String?
  zip                     String?

  // Profile & Account Status
  avatar                  String? // Corrected field name for clarity
  role                    String    @default("user") // "user" or "artist" or "admin" (defined in code)
  isAccountVerified       Boolean @default(false)
  isArtistVerified        Boolean @default(false)
  isMarketingOptIn  Boolean @default(false)
  isDataSharingOptIn Boolean @default(false)

  // Personal Information
  gender                  String?
  dob                     DateTime?

  // OAuth Provider IDs (for social login)
  googleId                String? @unique
  facebookId              String? @unique
  appleId                 String? @unique

  // Timestamps
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  artist                  Artist?   // One-to-one relation with Artist
  bookings                Booking[] // Bookings made by this client user
  videos                  Video[]   // Videos uploaded by this user
  bookmarks               Bookmark[] // NEW: Bookmarks made by this user

  @@index([email])
  @@index([phoneNumber])
  @@map("users")
}

// âœ… NEW MODEL: VerificationToken - Used for temporary codes (OTP, email confirmation, etc.)
model VerificationToken {
  id          String    @id @default(cuid())
  identifier  String    // The email or phone number to be verified
  token       String    @unique // The actual OTP or verification hash
  expires     DateTime
  createdAt   DateTime  @default(now())

  // Enforce a unique token for each identifier (e.g., prevent sending the same OTP twice quickly)
  @@unique([identifier, token])
  @@index([identifier])
  @@map("verification_tokens")
}

// Artist Model - Extended profile for artists
model Artist {
  id                      String    @id @default(cuid())
  userId                  String    @unique
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Basic Artist Information
  stageName               String?
  artistType              String?
  subArtistType           String?
  achievements            String?   @db.Text
  yearsOfExperience       Int?
  shortBio                String?   @db.Text

  // Performance Details (stored as comma-separated values for flexibility)
  performingLanguage      String?   @db.Text   // Multi-value: "Hindi,English,Punjabi"
  performingEventType     String?   @db.Text   // Multi-value: "Wedding,Corporate,Concert"
  performingStates        String?   @db.Text   // Multi-value: "Maharashtra,Delhi,Karnataka"

  // Performance Duration & Team
  performingDurationFrom  String?
  performingDurationTo    String?
  performingMembers       String?   @db.Text   // Multi-value
  offStageMembers         String?   @db.Text   // Multi-value

  // Contact Information
  contactNumber           String?
  whatsappNumber          String?
  contactEmail            String?

  // Pricing Information
  soloChargesFrom         Decimal? @db.Decimal(10, 2)
  soloChargesTo           Decimal? @db.Decimal(10, 2)
  soloChargesDescription  String?  @db.Text

  chargesWithBacklineFrom         Decimal? @db.Decimal(10, 2)
  chargesWithBacklineTo           Decimal? @db.Decimal(10, 2)
  chargesWithBacklineDescription  String?  @db.Text

  // Social Media Integration (for future API integration)
  youtubeChannelId        String?
  instagramId             String?

  // Timestamps
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  bookingsReceived        Booking[]   // Bookings received by this artist
  bookmarkedByUsers       Bookmark[] // NEW: Bookmarks referencing this artist

  @@index([userId])
  @@index([artistType])
  @@map("artists")
}

// Content Model - Represents a long-form video uploaded by an Artist
model Video {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id]) // The artist/user who uploaded the video

  title           String
  description     String?   @db.Text
  url             String    // The main video file URL
  thumbnailUrl    String?   // The thumbnail image URL

  // Video Metrics & Status
  duration        Int       // Duration in seconds
  views           Int       @default(0) // View count
  isApproved      Boolean   @default(false) // Admin approval status

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  bookmarkedByUsers Bookmark[] // NEW: Bookmarks referencing this video

  @@index([userId])
  @@index([isApproved])
  @@map("videos")
}

// NEW: Bookmark Model - Allows users to save either a Video OR an Artist
model Bookmark {
  id              String    @id @default(cuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])

  // Bookmarking EITHER a Video OR an Artist (Exclusive relation)
  videoId         String?
  video           Video?    @relation(fields: [videoId], references: [id], onDelete: Cascade)

  artistId        String?
  artist          Artist?   @relation(fields: [artistId], references: [id], onDelete: Cascade)

  createdAt       DateTime  @default(now())

  // Enforce uniqueness: A user can only bookmark a specific video or artist once.
  @@unique([userId, videoId])
  @@unique([userId, artistId])

  @@index([userId])
  @@map("bookmarks")
}

// Booking Model - Represents a booking request from a User (Client) to an Artist
model Booking {
  id              String          @id @default(cuid())

  // Relations
  clientId        String          // The user who made the booking
  client          User            @relation(fields: [clientId], references: [id])

  artistId        String          // The artist being booked
  artist          Artist          @relation(fields: [artistId], references: [id])

  // Booking Details
  eventDate       DateTime
  eventType       String?
  eventLocation   String? // Free-text location/venue
  eventAddress    String?

  // Financials
  totalPrice      Decimal         @db.Decimal(10, 2) // Quoted price for the event

  // Status & Timestamps
  status          BookingStatus @default(PENDING)
  notes           String?         @db.Text

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([clientId])
  @@index([artistId])
  @@index([status])
  @@map("bookings")
}